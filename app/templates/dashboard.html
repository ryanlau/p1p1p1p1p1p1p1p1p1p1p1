{% import 'macros.html' as macros %}
{% extends "layout.html" %}

{% block title %} dashboard {%endblock%}
{% block content %}


<div class="m-3 m-x-lg-5">
    <header class="mt-3 mx-2">
        <div class="d-flex align-items-center justify-content-between">
            <div class="text-start" style="width: 120px;">
                <h4 id="time"></h4>
            </div>
            <div class="text-center flex-grow-1">
                <h2>good morning, {{username}}</h2>
            </div>
            <div class="text-end" style="width: 120px;">

                <div class="dropdown">
                    <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false"
                        style="border: none!important;">
                        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTGoXB7j_kcS4M5UEPSxSjenwmMTHYwcZc5tmw66pXXJw&s"
                            alt="profile picture" class="rounded-circle" style="width: 36px; height: 36px;">
                    </button>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="/settings">settings</a></li>
                        <li><a class="dropdown-item" href="/logout">logout</a></li>
                    </ul>
                </div>

            </div>
        </div>

        <div class="row">
            <div class="col">
                <p class="text-center">
                    "{{quote}}"
                </p>
            </div>
        </div>
    </header>


    <div class="row">
        <div class="col-12 col-lg-4">
            {% call macros.card('news') %}
                <div class="d-flex flex-column" style="row-gap: 16px;">
                    {% for i in range(10) %}
                        {{ macros.article(news_data[i]["title"], news_data[i]["abstract"], news_data[i]["url"], news_data[i]["multimedia"][0]["url"]) }}
                    {% endfor %}
                </div>
            {% endcall %}
        </div>
        <div class="col-12 col-lg-4">
            {% call macros.card('weather') %}
            poopity
            {% endcall %}
            {% call macros.card('stocks') %}
            <div class="row py-2 gy-4">
                {% for ticker, data in stock_data.items() %}
                {{ macros.stock_card(ticker, data.name, data.price, data.change) }}
                {% endfor %}

                {% if stock_data.items()|length == 0 %}
                <div class="col-12">
                    <div class="px-1 ">
                        <h6 class="mb-0">
                            No stocks in watchlist
                        </h6>
                    </div>
                </div>
                {% endif %}
            </div>
            <button type="button" class="btn btn-secondary mt-2" data-bs-toggle="modal" data-bs-target="#add-stock">
                add stock to watchlist
            </button>
            {% endcall %}
        </div>
        <div class="col-12 col-lg-4">
            {% call macros.card('todos') %}
<ul class="list-group mt-2">
    {% for todo_item in todos %}
        {{ macros.todo_item(todo_item[0], todo_item[1], todo_item[2]) }}
    {% endfor %}
</ul>

                {% if todos|length == 0 %}
                <div class="col-12">
                    <div class="px-1 ">
                        <h6 class="mb-0">
                            Nothing to do!
                        </h6>
                    </div>
                </div>
                {% endif %}

            <button type="button" class="btn btn-secondary mt-3" data-bs-toggle="modal" data-bs-target="#add-todo">
                add todo
            </button>
            <a href="/api/todos/remove_completed">
                <button type="button" class="btn btn-danger mt-3 ms-2">
                    delete completed todos
                </button>
            </a>
            {% endcall %}
        </div>
    </div>
</div>



<div class="modal fade" id="add-stock" tabindex="-1" aria-labelledby="add-stock-modal" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5">add stock to watchlist</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="add-stock-form" action="/api/stocks/add" method="POST">
                    <label for="stock-ticker" class="form-label">ticker</label>
                    <input name="ticker" type="text" id="stock-ticker" placeholder="AAPL" class="form-control">
                    <div class="form-text mt-3">If ticker does not exist, nothing will be added to your watchlist.</div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">close</button>
                <button type="submit" form="add-stock-form" class="btn btn-primary">add stock</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="add-todo" tabindex="-1" aria-labelledby="add-todo-modal" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5">add todo</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="add-todo-form" action="/api/todos/add" method="POST">
                    <input name="todo" type="text" id="todo" placeholder="Walk the dog" class="form-control">
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">close</button>
                <button type="submit" form="add-todo-form" class="btn btn-primary">add todo</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="static/js/stocks.js"></script>
<script src="static/js/time.js"></script>
<script src="static/js/todo.js"></script>
<script>
    createCharts({{ stock_data|tojson }})
</script>


{% endblock %}