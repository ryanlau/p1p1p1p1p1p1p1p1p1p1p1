{% import 'macros.html' as macros %}
{% extends "layout.html" %}

{% block title %} dashboard {%endblock%}
{% block content %}


<div class="m-3 m-x-lg-5">
    <header class="mt-3 mx-2">
        <div class="d-flex align-items-center justify-content-between">
            <div class="text-start" style="width: 120px;">
                <h4 id="time"></h4>
            </div>
            <div class="text-center flex-grow-1">
                <h2>good morning, {{username}}</h2>
            </div>
            <div class="text-end" style="width: 120px;">

                <div class="dropdown">
                    <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false"
                        style="border: none!important;">
                        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTGoXB7j_kcS4M5UEPSxSjenwmMTHYwcZc5tmw66pXXJw&s"
                            alt="profile picture" class="rounded-circle" style="width: 36px; height: 36px;">
                    </button>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="/settings">settings</a></li>
                        <li><a class="dropdown-item" href="/logout">logout</a></li>
                    </ul>
                </div>

                <!-- <h4> <a href="/logout" class="text-reset text-decoration-none">logout</a></h4> -->
            </div>
        </div>

        <div class="row">
            <div class="col">
                <p class="text-center">
                    "{{quote}}"
                </p>
            </div>
        </div>
    </header>


    <div class="row">
        <div class="col-12 col-lg-4">
            <div class="card mb-4" id="news">
                <div class="d-flex card-header align-items-center">
                  <h5 class="flex-grow-1 mb-0">news</h5>
                  <a href="{{ news_url }}" class="text-reset text-decoration-none" style="margin-top: -4px">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-up-right"
                      viewBox="0 0 16 16">
                      <path fill-rule="evenodd"
                        d="M14 2.5a.5.5 0 0 0-.5-.5h-6a.5.5 0 0 0 0 1h4.793L2.146 13.146a.5.5 0 0 0 .708.708L13 3.707V8.5a.5.5 0 0 0 1 0v-6z" />
                    </svg>
                  </a>
                </div>
                <div class="card-body">
                    <div>
                        <h3 class="text-center mb-3">{{ news_title }}</h3>
                        <p>{{ news_blurb }}</p>
                        <img src="{{ news_img }}" width="400" class="rounded img-thumbnail mx-auto d-block">
                    </div>
                </div>
            </div>
        </div>
        <div class="col-12 col-lg-4">
            {% call macros.card('weather') %}
            poopity
            {% endcall %}
            {% call macros.card('stocks') %}
            <div class="row py-2 gy-4">
                {% for ticker, data in stock_data.items() %}
                {{ macros.stock_card(ticker, data.name, data.price, data.change) }}
                {% endfor %}

                {% if stock_data.items()|length == 0 %}
                <div class="col-12">
                    <div class="px-1 ">
                        <h6 class="mb-0">
                            No stocks in watchlist
                        </h6>
                    </div>
                </div>
                {% endif %}
            </div>
            <button type="button" class="btn btn-secondary mt-2" data-bs-toggle="modal" data-bs-target="#add-stock">
                add stock to watchlist
            </button>
            {% endcall %}
        </div>
        <div class="col-12 col-lg-4">
            {% call macros.card('todos') %}
<ul class="list-group mt-2">
    {% for todo_item in todos %}
        {{ macros.todo_item(todo_item[0], todo_item[1], todo_item[2]) }}
    {% endfor %}
</ul>

                {% if todos|length == 0 %}
                <div class="col-12">
                    <div class="px-1 ">
                        <h6 class="mb-0">
                            Nothing to do!
                        </h6>
                    </div>
                </div>
                {% endif %}

            <button type="button" class="btn btn-secondary mt-3" data-bs-toggle="modal" data-bs-target="#add-todo">
                add todo
            </button>
            <button type="button" class="btn btn-danger mt-3 ms-2">
                delete completed todos
            </button>
            {% endcall %}
        </div>
    </div>
</div>



<div class="modal fade" id="add-stock" tabindex="-1" aria-labelledby="add-stock-modal" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5">add stock to watchlist</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="add-stock-form" action="/api/stocks/add" method="POST">
                    <label for="stock-ticker" class="form-label">ticker</label>
                    <input name="ticker" type="text" id="stock-ticker" placeholder="AAPL" class="form-control">
                    <div class="form-text mt-3">If ticker does not exist, nothing will be added to your watchlist.</div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">close</button>
                <button type="submit" form="add-stock-form" class="btn btn-primary">add stock</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="add-todo" tabindex="-1" aria-labelledby="add-todo-modal" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5">add todo</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="add-todo-form" action="/api/todos/add" method="POST">
                    <input name="todo" type="text" id="todo" placeholder="Walk the dog" class="form-control">
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">close</button>
                <button type="submit" form="add-todo-form" class="btn btn-primary">add todo</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="static/js/stocks.js"></script>
<script src="static/js/time.js"></script>
<script>
    createCharts({{ stock_data| tojson}})
</script>


{% endblock %}